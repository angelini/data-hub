{% extends 'base.html.j2' %}

{% block menu %}
  <li class="pure-menu-item"><a href="{{ url_for('hubs.hubs_index_html') }}" class="pure-menu-link">Hubs</a></li>
  <li class="pure-menu-item"><a href="{{ url_for('datasets.datasets_index_html', hub_id=hub_id) }}" class="pure-menu-link">Datasets</a></li>
{% endblock %}

{% block header %}
  <h1>New Version</h1>
{% endblock %}

{% block content %}
  <form id="new-version" action="{{ url_for('versions.version_new_html', hub_id=hub_id, dataset_id=dataset_id) }}" method="post" class="pure-form pure-form-aligned">
    <fieldset>
      <div class="pure-control-group">
        <label for="backend">Backend Name</label>
        <select id="backend" name="backend">
          {% for backend in backends %}
            <option value="{{ backend.module }}">{{ backend.module }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="pure-control-group">
        <label for="path">Path</label>
        <input id="path" name="path" type="text" placeholder="/example">
      </div>

      <div class="pure-control-group">
        <label for="description">Description</label>
        <input id="description" name="description" type="text" placeholder="">
      </div>

      <div class="pure-control-group">
        <label for="is_overlapping">Has Overlapping Partitions</label>
        <input id="is_overlapping" name="is_overlapping" type="checkbox">
      </div>
    </fieldset>
  </form>

  <form class="pure-form">
    <fieldset class="dynamic-rows">
      <h2>Columns</h2>
      <button class="add-row pure-button pure-button-active">Add Column</button>
      <table class="pure-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Description</th>
            <th>Nullable</th>
            <th>Unique</th>
            <th>Contains PII</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input name="column_name[]" type="text" placeholder="Name" form="new-version"></td>
            <td>
              <select name="column_type[]" form="new-version">
                {% for type_entry in types %}
                  <option value="{{ type_entry.name }}">{{ type_entry.name }}</option>
                {% endfor %}
              </select>
            </td>
            <td><input name="column_description[]" type="text" placeholder="Description" form="new-version"></td>
            <td>
              <input type="checkbox">
              <input hidden checked name="column_is_nullable[]" type="text" value="false" form="new-version">
            </td>
            <td>
              <input type="checkbox">
              <input hidden checked name="column_is_unique[]" type="text" value="false" form="new-version">
            </td>
            <td>
              <input type="checkbox">
              <input hidden checked name="column_has_pii[]" type="text" value="false" form="new-version">
            </td>
            <td><button class="remove-row pure-button pure-button-active">Remove</button></td>
          </tr>
        </tbody>
      </table>
    </fieldset>
  </form>

  <form class="pure-form">
    <fieldset class="dynamic-rows">
      <h2>Partition Keys</h2>
      <button class="add-row pure-button pure-button-active">Add Partition Key</button>
      <table class="pure-table">
        <thead>
          <tr>
            <th>Key</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input name="partition_name[]" type="text" placeholder="Key" form="new-version"></td>
            <td><button class="remove-row pure-button pure-button-active">Remove</button></td>
          </tr>
        </tbody>
      </table>
    </fieldset>
  </form>

  <form class="pure-form pure-form-aligned">
    <fieldset>
      <div class="pure-controls">
        <button type="submit" class="pure-button pure-button-primary" form="new-version">Add Version</button>
      </div>
    </fieldset>
  </form>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='dynamicRows.js') }}"></script>
{% endblock %}
